{"ast":null,"code":"import { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nimport _regeneratorRuntime from \"C:/Users/Ruturaj/Downloads/wordpress react/node_modules/@babel/runtime/regenerator\";\nimport _asyncToGenerator from \"C:/Users/Ruturaj/Downloads/wordpress react/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";\nimport _slicedToArray from \"C:/Users/Ruturaj/Downloads/wordpress react/node_modules/@babel/runtime/helpers/esm/slicedToArray\";\n\nvar _jsxFileName = \"C:\\\\Users\\\\Ruturaj\\\\Downloads\\\\wordpress react\\\\src\\\\components\\\\cart\\\\AddToCartButton.js\",\n    _this = this,\n    _s = $RefreshSig$();\n\nimport { useState, useContext } from \"react\";\nimport { useQuery, useMutation } from '@apollo/client';\nimport Link from \"next/link\";\nimport { v4 } from 'uuid';\nimport cx from 'classnames';\nimport { AppContext } from \"../context/AppContext\";\nimport { getFormattedCart } from \"../../functions\";\nimport GET_CART from \"../../queries/get-cart\";\nimport ADD_TO_CART from \"../../mutations/add-to-cart\";\n\nvar AddToCart = function AddToCart(props) {\n  _s();\n\n  var _product$externalUrl;\n\n  var product = props.product;\n  var productQryInput = {\n    clientMutationId: v4(),\n    // Generate a unique id.\n    productId: product.productId\n  };\n\n  var _useContext = useContext(AppContext),\n      cart = _useContext[0],\n      setCart = _useContext[1];\n\n  var _useState = useState(false),\n      showViewCart = _useState[0],\n      setShowViewCart = _useState[1];\n\n  var _useState2 = useState(null),\n      requestError = _useState2[0],\n      setRequestError = _useState2[1]; // Get Cart Data.\n\n\n  var _useQuery = useQuery(GET_CART, {\n    notifyOnNetworkStatusChange: true,\n    onCompleted: function onCompleted() {\n      // Update cart in the localStorage.\n      var updatedCart = getFormattedCart(data);\n      localStorage.setItem('woo-next-cart', JSON.stringify(updatedCart)); // Update cart data in React Context.\n\n      setCart(updatedCart);\n    }\n  }),\n      data = _useQuery.data,\n      refetch = _useQuery.refetch; // Add to Cart Mutation.\n\n\n  var _useMutation = useMutation(ADD_TO_CART, {\n    variables: {\n      input: productQryInput\n    },\n    onCompleted: function onCompleted() {\n      // On Success:\n      // 1. Make the GET_CART query to update the cart with new values in React context.\n      refetch(); // 2. Show View Cart Button\n\n      setShowViewCart(true);\n    },\n    onError: function onError(error) {\n      if (error) {\n        var _error$graphQLErrors$, _error$graphQLErrors, _error$graphQLErrors$2;\n\n        setRequestError((_error$graphQLErrors$ = error === null || error === void 0 ? void 0 : (_error$graphQLErrors = error.graphQLErrors) === null || _error$graphQLErrors === void 0 ? void 0 : (_error$graphQLErrors$2 = _error$graphQLErrors[0]) === null || _error$graphQLErrors$2 === void 0 ? void 0 : _error$graphQLErrors$2.message) !== null && _error$graphQLErrors$ !== void 0 ? _error$graphQLErrors$ : '');\n      }\n    }\n  }),\n      _useMutation2 = _slicedToArray(_useMutation, 2),\n      addToCart = _useMutation2[0],\n      _useMutation2$ = _useMutation2[1],\n      addToCartRes = _useMutation2$.data,\n      addToCartLoading = _useMutation2$.loading,\n      addToCartError = _useMutation2$.error;\n\n  var handleAddToCartClick = /*#__PURE__*/function () {\n    var _ref = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee() {\n      return _regeneratorRuntime.wrap(function _callee$(_context) {\n        while (1) {\n          switch (_context.prev = _context.next) {\n            case 0:\n              setRequestError(null);\n              _context.next = 3;\n              return addToCart();\n\n            case 3:\n            case \"end\":\n              return _context.stop();\n          }\n        }\n      }, _callee);\n    }));\n\n    return function handleAddToCartClick() {\n      return _ref.apply(this, arguments);\n    };\n  }();\n\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    children: [\"ExternalProduct\" === product.__typename ? /*#__PURE__*/_jsxDEV(\"a\", {\n      href: (_product$externalUrl = product === null || product === void 0 ? void 0 : product.externalUrl) !== null && _product$externalUrl !== void 0 ? _product$externalUrl : '/',\n      target: \"_blank\",\n      className: \"px-3 py-1 rounded-sm mr-3 text-sm border-solid border border-current inline-block hover:bg-purple-600 hover:text-white hover:border-purple-600\",\n      children: \"Buy now\"\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 72,\n      columnNumber: 21\n    }, _this) : /*#__PURE__*/_jsxDEV(\"button\", {\n      disabled: addToCartLoading,\n      onClick: handleAddToCartClick,\n      className: cx('px-3 py-1 rounded-sm mr-3 text-sm border-solid border border-current', {\n        'hover:bg-purple-600 hover:text-white hover:border-purple-600': !addToCartLoading\n      }, {\n        'opacity-50 cursor-not-allowed': addToCartLoading\n      }),\n      children: addToCartLoading ? 'Adding to cart...' : 'Add to cart'\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 77,\n      columnNumber: 17\n    }, _this), showViewCart ? /*#__PURE__*/_jsxDEV(Link, {\n      href: \"/cart\",\n      children: /*#__PURE__*/_jsxDEV(\"button\", {\n        className: \"px-3 py-1 rounded-sm text-sm border-solid border border-current inline-block hover:bg-purple-600 hover:text-white hover:border-purple-600\",\n        children: \"View Cart\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 91,\n        columnNumber: 21\n      }, _this)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 90,\n      columnNumber: 17\n    }, _this) : '']\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 69,\n    columnNumber: 9\n  }, _this);\n};\n\n_s(AddToCart, \"xwDMGawHSpzbL/Yy/r+E4MLiaQs=\", false, function () {\n  return [useQuery, useMutation];\n});\n\n_c = AddToCart;\nexport default AddToCart;\n\nvar _c;\n\n$RefreshReg$(_c, \"AddToCart\");","map":{"version":3,"sources":["C:/Users/Ruturaj/Downloads/wordpress react/src/components/cart/AddToCartButton.js"],"names":["useState","useContext","useQuery","useMutation","Link","v4","cx","AppContext","getFormattedCart","GET_CART","ADD_TO_CART","AddToCart","props","product","productQryInput","clientMutationId","productId","cart","setCart","showViewCart","setShowViewCart","requestError","setRequestError","notifyOnNetworkStatusChange","onCompleted","updatedCart","data","localStorage","setItem","JSON","stringify","refetch","variables","input","onError","error","graphQLErrors","message","addToCart","addToCartRes","addToCartLoading","loading","addToCartError","handleAddToCartClick","__typename","externalUrl"],"mappings":"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","sourcesContent":["import {useState, useContext} from \"react\";\nimport {useQuery, useMutation} from '@apollo/client';\nimport Link from \"next/link\";\nimport {v4} from 'uuid';\nimport cx from 'classnames';\n\nimport {AppContext} from \"../context/AppContext\";\nimport {getFormattedCart} from \"../../functions\";\nimport GET_CART from \"../../queries/get-cart\";\nimport ADD_TO_CART from \"../../mutations/add-to-cart\";\n\nconst AddToCart = (props) => {\n\n    const {product} = props;\n\n    const productQryInput = {\n        clientMutationId: v4(), // Generate a unique id.\n        productId: product.productId,\n    };\n\n    const [cart, setCart] = useContext(AppContext);\n    const [showViewCart, setShowViewCart] = useState(false);\n    const [requestError, setRequestError] = useState(null);\n\n        // Get Cart Data.\n    const {data, refetch} = useQuery(GET_CART, {\n            notifyOnNetworkStatusChange: true,\n            onCompleted: () => {\n\n                // Update cart in the localStorage.\n                const updatedCart = getFormattedCart(data);\n                localStorage.setItem('woo-next-cart', JSON.stringify(updatedCart));\n\n                // Update cart data in React Context.\n                setCart(updatedCart);\n            }\n        });\n\n    // Add to Cart Mutation.\n    const [addToCart, {\n        data: addToCartRes,\n        loading: addToCartLoading,\n        error: addToCartError\n    }] = useMutation(ADD_TO_CART, {\n        variables: {\n            input: productQryInput,\n        },\n        onCompleted: () => {\n            // On Success:\n            // 1. Make the GET_CART query to update the cart with new values in React context.\n            refetch();\n\n            // 2. Show View Cart Button\n            setShowViewCart(true)\n        },\n        onError: (error) => {\n            if (error) {\n                setRequestError(error?.graphQLErrors?.[0]?.message ?? '');\n            }\n        }\n    });\n\n    const handleAddToCartClick = async () => {\n        setRequestError(null);\n        await addToCart();\n    };\n\n    return (\n        <div>\n            {/*\tCheck if its an external product then put its external buy link */}\n            {\"ExternalProduct\" === product.__typename ? (\n                    <a href={product?.externalUrl ?? '/'} target=\"_blank\"\n                       className=\"px-3 py-1 rounded-sm mr-3 text-sm border-solid border border-current inline-block hover:bg-purple-600 hover:text-white hover:border-purple-600\">\n\t\t\t\t\t\tBuy now\n                    </a>\n                ) :\n                <button\n\t\t\t\t\tdisabled={addToCartLoading}\n                    onClick={handleAddToCartClick}\n                    className={cx(\n                        'px-3 py-1 rounded-sm mr-3 text-sm border-solid border border-current',\n                        {'hover:bg-purple-600 hover:text-white hover:border-purple-600': !addToCartLoading},\n                        {'opacity-50 cursor-not-allowed': addToCartLoading}\n                    )}\n                >\n\t\t\t\t\t{ addToCartLoading ? 'Adding to cart...' : 'Add to cart' }\n                </button>\n            }\n            {showViewCart ? (\n                <Link href=\"/cart\">\n                    <button\n                        className=\"px-3 py-1 rounded-sm text-sm border-solid border border-current inline-block hover:bg-purple-600 hover:text-white hover:border-purple-600\">View\n                        Cart\n                    </button>\n                </Link>\n            ) : ''}\n        </div>\n    );\n};\n\nexport default AddToCart;\n"]},"metadata":{},"sourceType":"module"}